ACDiscountApp.CartPage.Show_CalculateTier=function(){let e=!1;var a=function(e,a,l,r,t,i){if(t){var o=globalFields.ConvertToFixedDecimalNumber(e.original_price/100),n=globalFields.ConvertToFixedDecimalNumber(e.original_line_price/100),c=a==o;a=globalFields.ConvertToFixedDecimalString(a),l=globalFields.ConvertToFixedDecimalString(l),r||c?(e.original_price==e.discounted_price?(jQuery(".t4s-cartPage__items .t4s-cart_meta_prices").eq(i).html('<div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>"),jQuery(".t4s-drawer__main .t4s-mini_cart__info .t4s-mini_cart__meta").eq(i).html('<div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>")):jQuery(".t4s-cartPage__items .t4s-cart_meta_prices").eq(i).html('<div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>"),jQuery(".t4s-cartPage__items .t4s-cart-item-price").eq(i).html('<div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+"</span></div>"),jQuery(".drawer__inner .cart-item__totals.right").eq(i).html('<div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+"</span></div>")):(o=globalFields.ConvertToFixedDecimalString(o),n=globalFields.ConvertToFixedDecimalString(n),e.original_price==e.discounted_price?(jQuery(".t4s-cartPage__items .t4s-cart_meta_prices").eq(i).html('<div class="cart-item__original-price"><s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+o+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(o,globalFields.amount)+'</span></s></div> <div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>"),jQuery(".t4s-drawer__main .t4s-mini_cart__info .t4s-mini_cart__meta").eq(i).html('<div class="cart-item__original-price"><s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+o+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(o,globalFields.amount)+'</span></s></div> <div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>")):jQuery(".t4s-cartPage__items .t4s-cart_meta_prices").eq(i).html('<div class="cart-item__original-price"><s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+o+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(o,globalFields.amount)+'</span></s></div> <div><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span></div>"),jQuery(".t4s-cartPage__items .t4s-cart-item-price").eq(i).html('<div class="cart-item__original-price"><s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+n+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(n,globalFields.amount)+'</span></s></div> <div style="margin-left:5px"><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+"</span></div>"),jQuery(".drawer__inner .cart-item__totals.right").eq(i).html('<div class="cart-item__original-price"><s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+n+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(n,globalFields.amount)+'</span></s></div> <div style="margin-left:5px"><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+"</span></div>"))}jQuery(".t4s-cart_discount_price").remove()},l=function(){$('.t4s-cartPage__footer   .t4s-btn-group__checkout-update button[name="checkout"]').removeClass("t4s-btn__checkout"),jQuery('.t4s-cartPage__footer   .t4s-btn-group__checkout-update button[name="checkout"]').click((function(){d(globalFieldsCartPage_AC.cartObj,!1),t(!1)}))},r=function(){jQuery('.t4s-drawer__bottom button[name="checkout"]').click((function(e){e.preventDefault(),t(!0)}))},t=function(a){c>0&&!e?jQuery.ajax({type:"POST",async:!1,url:"https://customerapp.anncode.com/tier/ACPGenerateDiscountCode",data:{priceDifference:c,subTotal:n,variantIds:o.toString()},success:function(l){e=!0;var r=JSON.stringify(l),t=JSON.parse(r),i=t.PRID,o=t.DCID,n=t.DiscountCode;p("discountCodes",i+"-"+o+"-"+n,30),a?(m(n),window.location.href="/checkout?discount="+n):(m(n),jQuery('form[action="/cart"]').append('<input id="discount_input" type="hidden" name="discount" value="'+n+'">'),window.location.href="/checkout?discount="+n)},error:function(e){console.log(e.statusText),window.location.href="/checkout"}}):window.location.href="/checkout"},o=[],n=0,c=0,s=null,d=function(e,l){o=[],n=0,c=0;var r=0;for(k=0;k<e.items.length;k++){var t=e.items[k],i=!0;if(itemTiers=u(t.variant_id),null!=itemTiers&&itemTiers.status&&globalFields.StartEndDateValid(itemTiers.start_date,itemTiers.end_date)){let e=null!=itemTiers.DiscountAppliedON&&""!=itemTiers.DiscountAppliedON&&null!=itemTiers.DiscountAppliedON,a=null!=itemTiers.Location_Tag_&&""!=itemTiers.Location_Tag_&&null!=itemTiers.Location_Tag_;if(e)if(a){let e="Both_Store"==itemTiers.DiscountAppliedON||"Online_Store"==itemTiers.DiscountAppliedON,a=Object.keys(itemTiers.Location_Tag_);if("StoreLocation"==a[0]){if(!(!itemTiers.Location_Tag_[a[0]].includes(globalFields.Storecountry)&&!itemTiers.Location_Tag_[a[0]].includes(globalFields.Storecity))&&e)r=(d=g(t,itemTiers,r,l,!0,k))[0],i=d[1],d[1]&&(r+=globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100));else r+=globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100)}else{let o=itemTiers.Location_Tag_[a[0]],n=globalFields.Customercountry,c=globalFields.Customercity,s=(e,a)=>e.some((e=>a.includes(e))),u=(e,a)=>e.some((e=>a.includes(e))),m=s(o,n),y=u(o,c);if(e&&(m||y))r=(d=g(t,itemTiers,r,l,!0,k))[0],i=d[1],d[1]&&(r+=globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100));else r+=globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100)}}else{var d;if("Both_Store"==itemTiers.DiscountAppliedON||"Online_Store"==itemTiers.DiscountAppliedON)r=(d=g(t,itemTiers,r,l,!0,k))[0],i=d[1],d[1]&&(r+=globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100));else r+=globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100)}else r=(d=g(t,itemTiers,r,l,!0,k))[0],i=d[1],d[1]&&(r+=globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100))}else a(t,globalFields.ConvertToFixedDecimalNumber(t.original_price/100),globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100),!0,!0,k),r+=globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100);i||(n+=globalFields.ConvertToFixedDecimalNumber(t.original_line_price/100),o.push(t.variant_id))}!function(e,a,l){e&&(a=globalFields.ConvertToFixedDecimalString(a),(l=globalFields.ConvertToFixedDecimalString(l))!=a?(jQuery(".t4s-drawer__bottom .t4s-col-auto.t4s-text-right").html('<s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+'</span></s> <span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>"),jQuery(".t4s-cartPage__footer .t4s-cart__ttprice").html('<s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+'</span></s> <span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>")):(jQuery(".t4s-drawer__bottom .t4s-col-auto.t4s-text-right").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>"),jQuery(".t4s-cartPage__footer .t4s-cart__ttprice").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>")))}(l,globalFields.ConvertToFixedDecimalNumber(r),globalFields.ConvertToFixedDecimalNumber(e.original_total_price/100)),c=globalFields.ConvertToFixedDecimalNumber(globalFields.ConvertToFixedDecimalNumber(e.original_total_price/100)-globalFields.ConvertToFixedDecimalNumber(r)),function(e){if(c>0&&e&&globalFields.isCartPage){var a='<span id="saved-banner">'+globalFields.settings.cart_saving_message.replace("{{discount_amount}}",'<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+c.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(c.toFixed(2),globalFields.amount)+"</span>")+"</span>";jQuery(window).width()<700?0==jQuery("#saved-banner-div").length?jQuery(".t4s-cartPage__footer  .t4s-cart-total").after('<div id="saved-banner-div" style="text-align: center;" class="col-md-14">'+a+"</div>"):jQuery("#saved-banner-div").html(a):0==jQuery("#saved-banner-div").length?jQuery(".t4s-cartPage__footer  .t4s-cart-total").after('<div id="saved-banner-div" style="text-align: end;" class="col-md-14">'+a+"</div>"):jQuery("#saved-banner-div").html(a)}else globalFields.isCartPage&&jQuery("#saved-banner-div").remove()}(l),jQuery('#cart-notification button[name="checkout"],.drawer__footer button[name="checkout"]').text("\n            Check out\n          "),jQuery(".cart__checkout-button.button").text("\n            Check out\n          "),c&&(s=setInterval((function(){jQuery(".additional_checkout_buttons, .dynamic-checkout__content").length>0&&(jQuery(".additional_checkout_buttons, .dynamic-checkout__content").hide(),clearInterval(s))}),500)),setTimeout((function(){clearInterval(s)}),5e3)};setTimeout((function(){clearInterval(s)}),1e4);var u=function(e){var a=jQuery.grep(globalFieldsCartPage_AC.cartTiersArray,(function(a){return a.variant_id===e}));return"[]"==a[0].tiers?void 0:globalFields.GetTierObject(a[0].tiers[0],e)},g=function(e,l,r,t,o,n){for(i=0;i<l.tier_min.length;i++){var c=0,s=parseFloat(l.tier_values[i]),d=parseInt(l.tier_min[i]),u="max"!=l.tier_max[i]?parseInt(l.tier_max[i]):l.tier_max[i],g=0,m=0,y=!1,b=!1;if("products"===l.entity_type||"collections"===l.entity_type){var _=[];if("collections"===l.entity_type)for(var F=jQuery.grep(globalFieldsCartPage_AC.cartTiersArray,(function(e){return"[]"!=e.tiers&&"collections"==e.tiers[0].entity_type&&e.tiers[0].entity_id==l.entity_id})),p=0;p<F.length;p++){var v=jQuery.grep(globalFieldsCartPage_AC.cartObj.items,(function(e){return e.variant_id==F[p].variant_id}));0!=v.length&&_.push(v[0])}else _=jQuery.grep(globalFieldsCartPage_AC.cartObj.items,(function(a){return a.product_id==e.product_id}));for(j=0;j<_.length;j++)c+=_[j].quantity;y=c>=d,b="max"==u||c<=u}else y=e.quantity>=d,b="max"==u||e.quantity<=u;if(y&&b){if(o=!1,"percentage"==l.discount_type){var f=parseFloat(globalFields.ConvertToFixedDecimalNumber(parseFloat(s)/100*globalFields.ConvertToFixedDecimalNumber(e.original_price/100)));g=globalFields.ConvertToFixedDecimalNumber(globalFields.ConvertToFixedDecimalNumber(e.original_price/100)-f)}else"fixed"==l.discount_type?g=globalFields.ConvertToFixedDecimalNumber(globalFields.ConvertToFixedDecimalNumber(e.original_price/100)-parseFloat(s)):"fixed_price"==l.discount_type&&(g=globalFields.ConvertToFixedDecimalNumber(parseFloat(s)));g<0&&(g=0),m=globalFields.ConvertToFixedDecimalNumber(g*e.quantity),r+=globalFields.ConvertToFixedDecimalNumber(m),a(e,g,m,o,t,n)}}return o&&a(e,globalFields.ConvertToFixedDecimalNumber(e.original_price/100),globalFields.ConvertToFixedDecimalNumber(e.original_line_price/100),o,t,n),[r,o]},m=function(e){jQuery.ajax({type:"HEAD",url:"/discount/"+e,success:function(e){},error:function(e){console.log(e.statusText)}})},y=function(){jQuery.ajax({async:!1,url:"/cart/?view=ac_cart_tiers",success:function(e){globalFieldsCartPage_AC.cartTiersArray=JSON.parse(e),d(globalFieldsCartPage_AC.cartObj,!0)},error:function(e){console.log(e.statusText)}})};jQuery(document).ajaxComplete((function(e,a,l){b(l.url,a.responseText)}));var b=function(e,a){"undefined"!=e&&""!=e&&null!=e&&("/cart.js"!=(e=e.split("?"))[0]&&"/cart/change.js"!=e[0]||(jQuery('#cart-notification button[name="checkout"],.drawer__footer button[name="checkout"]').text("\n            Loading...\n          "),jQuery(".cart__checkout-button.button").text("\n            Loading...\n          "),globalFieldsCartPage_AC.cartObj=JSON.parse(a),setTimeout((function(){y(),r()}),1200)))};try{var _=window.fetch;window.fetch=function(...e){return(e[0].includes("/cart/change")||e[0].includes("/cart/add"))&&setTimeout((function(){fetch("/cart.js").then((e=>e.json().then((a=>({status:e.status,body:a}))))).then((e=>b("/cart.js",JSON.stringify(e.body))))}),800),_.apply(window,e)}}catch(e){}var F=function(){y()};!async function(){try{const e=await fetch("/discount/CLEAR");if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const a=e.headers.get("Content-Type");if(a&&a.includes("application/json")){await e.json()}else $(".t4s-order-discount__item").remove()}catch(e){}}(),setTimeout((function(){d(globalFieldsCartPage_AC.cartObj,!0),l(),r(),F()}),1800);var p=function(e,a,l){var r=new Date;r.setTime(r.getTime()+24*l*60*60*1e3);var t="expires="+r.toUTCString();document.cookie=e+"="+a+";"+t+";path=/"};$('.t4s-cartPage__footer   .t4s-btn-group__checkout-update button[name="checkout"]').removeClass("t4s-btn__checkout"),d(globalFieldsCartPage_AC.cartObj,!0),l(),r(),F()};var globalFieldsCartPage_AC=new ACDiscountApp.CartPage.Global,cartObject=new ACDiscountApp.CartPage.Show_CalculateTier;
