ACDiscountApp.CartPage.Show_CalculateTier=function(){var e=function(){jQuery('.cart__footer .cart__ctas button[name="checkout"]').click((function(){n(globalFieldsCartPage_AC.cartObj,!1),l(!1)}))},a=function(){jQuery('.drawer__footer .cart__ctas button[name="checkout"]').click((function(e){e.preventDefault(),l(!0)}))},l=function(e){r>0?$.ajax({type:"POST",async:!1,url:"https://customerapp.anncode.com/tier/ACPGenerateCartCode",data:{discountOff:r,subTotal:o,discounType:"fixed_amount"},success:function(a){try{if("error"!=a.status||a.DiscountCode){var l=JSON.stringify(a),t=JSON.parse(l),o=t.PRID,r=t.DCID,i=t.DiscountCode;b("discountCodes",o+"-"+r+"-"+i,30),e?(d(i),window.location.href="/checkout?discount="+i):(d(i),jQuery('form[action="/cart"]').append('<input id="discount_input" type="hidden" name="discount" value="'+i+'">'))}else window.location.href="/checkout"}catch(e){console.log(e)}},error:function(e){console.log(e.statusText)}}):e&&(window.location.href="/checkout")},t=[],o=0,r=0,n=function(e,a){t=[],o=0,r=0;var l=0,i=0,n=globalFieldsCartPage_AC.cartSubTotalMetafield;let d=!0;if(d=null!=n&&"[]"!=n&&(null!=n.DiscountAppliedON&&("Both_Store"==n.DiscountAppliedON||"Online_Store"==n.DiscountAppliedON)),null!=n&&"[]"!=n&&n.status&&d&&globalFields.StartEndDateValid(n.start_date,n.end_date)){var u=s(n,globalFieldsCartPage_AC.is_quantity_total,!0);if(!u[3]){for(k=0;k<globalFieldsCartPage_AC.cartTiersArray.length;k++){var g=globalFieldsCartPage_AC.cartTiersArray[k];if(i+=globalFields.ConvertToFixedDecimalNumber(g.item.original_line_price/100),g.is_exclude||t.push(g.item.variant_id),"percentage"==n.discount_type)c(g.item,u[2],n,a,k)}o=i,l=i-u[5],function(e,a,l){e&&(a=globalFields.ConvertToFixedDecimalString(a),(l=globalFields.ConvertToFixedDecimalString(l))!=a?(jQuery(".js-contents .totals .totals__subtotal-value").html('<s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+'</span></s> <span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>"),jQuery(".drawer__footer .cart-drawer__footer .totals .totals__subtotal-value").html('<s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(l,globalFields.amount)+'</span></s> <span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>")):(jQuery(".js-contents .totals .totals__subtotal-value").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>"),jQuery(".drawer__footer .cart-drawer__footer .totals .totals__subtotal-value").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+a+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(a,globalFields.amount)+"</span>")))}(a,globalFields.ConvertToFixedDecimalNumber(l),globalFields.ConvertToFixedDecimalNumber(i)),r=u[5],function(e){if(r>0&&e&&globalFields.isCartPage){var a='<span id="saved-banner">'+globalFields.settings.cart_saving_message.replace("{{discount_amount}}",'<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+globalFields.formatMoney(r.toFixed(2),globalFields.amount)+"</span>")+"</span>";jQuery(window).width()<700?0==jQuery("#saved-banner-div").length?jQuery(".js-contents .totals").after('<div id="saved-banner-div" style="text-align: center;" class="col-md-14">'+a+"</div>"):jQuery("#saved-banner-div").html(a):0==jQuery("#saved-banner-div").length?jQuery(".js-contents .totals").after('<div id="saved-banner-div" style="text-align: end;" class="col-md-14">'+a+"</div>"):jQuery("#saved-banner-div").html(a)}else globalFields.isCartPage&&jQuery("#saved-banner-div").remove()}(a)}}},s=function(e,a,l){var t=jQuery.grep(globalFieldsCartPage_AC.cartTiersArray,(function(e){return!e.is_exclude})),o=0,r=0,n=0;for(j=0;j<t.length;j++)o+=t[j].item.quantity,r+=globalFields.ConvertToFixedDecimalNumber(t[j].item.original_line_price/100);var s=0,c=0,d="";for(i=0;i<e.tier_min.length;i++){s=parseFloat(e.tier_values[i]),c=parseInt(e.tier_min[i]),d="max"!=e.tier_max[i]?parseInt(e.tier_max[i]):e.tier_max[i];var u=!1,g=!1;if(a?(u=o>=c,g="max"==d||o<=d):(u=r>=c,g="max"==d||r<=d),u&&g){l=!1,"percentage"==e.discount_type?n=parseFloat(globalFields.ConvertToFixedDecimalNumber(parseFloat(s)/100*globalFields.ConvertToFixedDecimalNumber(r))):"fixed"==e.discount_type&&(n=globalFields.ConvertToFixedDecimalNumber(parseFloat(s)));break}}return[c,d,s,l,r,n]},c=function(e,a,l,t,o){var r=0;if("percentage"==l.discount_type){var i=parseFloat(globalFields.ConvertToFixedDecimalNumber(parseFloat(a)/100*globalFields.ConvertToFixedDecimalNumber(e.original_price/100)));r=globalFields.ConvertToFixedDecimalNumber(globalFields.ConvertToFixedDecimalNumber(e.original_price/100)-i)}r<0&&(r=0),function(e,a,l,t,o){if(t){var r=globalFields.ConvertToFixedDecimalNumber(e.original_price/100),i=globalFields.ConvertToFixedDecimalNumber(e.original_line_price/100),n=a==r;a=globalFields.ConvertToFixedDecimalString(a),l=globalFields.ConvertToFixedDecimalString(l),n||(r=globalFields.ConvertToFixedDecimalString(r),i=globalFields.ConvertToFixedDecimalString(i))}}(e,r,globalFields.ConvertToFixedDecimalNumber(r*e.quantity),t)},d=function(e){$.ajax({type:"HEAD",url:"/discount/"+e,success:function(e){},error:function(e){console.log(e.statusText)}})};jQuery(document).ajaxComplete((function(e,a,l){g(l.url,a.responseText)}));try{var u=window.fetch;window.fetch=function(...e){return(e[0].includes("/cart/change")||e[0].includes("/cart/add"))&&setTimeout((function(){fetch("/cart.js").then((e=>e.json().then((a=>({status:e.status,body:a}))))).then((e=>g("/cart.js",JSON.stringify(e.body))))}),500),u.apply(window,e)}}catch(e){}var g=function(l,t){"undefined"!=l&&""!=l&&null!=l&&("/cart.js"!=(l=l.split("?"))[0]&&"/cart/change.js"!=l[0]||(globalFieldsCartPage_AC.cartObj=JSON.parse(t),setTimeout((function(){jQuery.ajax({async:!1,url:"/cart/?view=ac_cart_subtotal_tiers",success:function(l){globalFieldsCartPage_AC.cartTiersArray=JSON.parse(l),n(globalFieldsCartPage_AC.cartObj,!0),e(),a()},error:function(e){console.log(e.statusText)}})}),500)))},b=function(e,a,l){var t=new Date;t.setTime(t.getTime()+24*l*60*60*1e3);var o="expires="+t.toUTCString();document.cookie=e+"="+a+";"+o+";path=/"};n(globalFieldsCartPage_AC.cartObj,!0),e(),a()};var globalFieldsCartPage_AC=new ACDiscountApp.CartPage.Global,cartObject=new ACDiscountApp.CartPage.Show_CalculateTier;
